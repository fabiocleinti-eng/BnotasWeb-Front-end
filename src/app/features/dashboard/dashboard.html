<div class="dashboard-container">
  
  <div class="toast-notification" *ngIf="showToast">{{ toastMessage }}</div>

  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="header-title-row">
        <h3>Minhas Notas</h3>
        <span class="fav-badge" *ngIf="favCount > 0" title="Total de Favoritas">â˜… {{ favCount }}</span>
      </div>
      <button class="btn-new-sidebar" (click)="createNote()">+ Nova</button>
    </div>

    <div class="search-box">
      <input type="text" placeholder="Buscar..." (input)="onSearch($event)">
    </div>

    <div class="notes-list-container">
      <div class="color-group" *ngFor="let group of noteGroups">
        <div class="group-header" (click)="toggleGroup(group)" [style.borderLeftColor]="group.color">
          <div class="group-label">
            <div class="color-badge" [style.backgroundColor]="group.color"></div>
            <span class="count">{{ group.notes.length }} notas</span>
            <span class="group-fav-badge" *ngIf="group.favCount > 0">â˜… {{ group.favCount }}</span>
          </div>
          <span class="arrow">{{ group.isOpen ? 'â–¼' : 'â–¶' }}</span>
        </div>

        <div class="group-notes" *ngIf="group.isOpen">
          <div class="mini-postit" *ngFor="let note of group.notes" (click)="openNote(note)" [style.backgroundColor]="group.color" [class.minimized]="note.isCollapsed">
            <div class="mini-header">
              <span class="mini-title">{{ note.titulo || 'Sem tÃ­tulo' }}</span>
              <div class="header-icons">
                <span *ngIf="note.favorita" class="mini-star">â˜…</span>
                <span *ngIf="note.dataLembrete" class="mini-clock" title="Tem lembrete">â°</span>
                <button class="btn-delete-header" (click)="deleteFromSidebar($event, note)" title="Excluir">ğŸ—‘ï¸</button>
                <button class="btn-collapse" (click)="toggleCollapse($event, note)">{{ note.isCollapsed ? 'â–¼' : 'â–²' }}</button>
              </div>
            </div>
            <div class="mini-body" *ngIf="!note.isCollapsed">
              <div class="mini-content" [innerHTML]="note.conteudo | slice:0:40"></div>
              <div class="mini-date" *ngIf="note.dataCriacao">{{ note.dataCriacao | date:'dd/MM/yyyy' }}</div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="noteGroups.length === 0" class="empty-list-msg">
        Nenhuma nota encontrada.
      </div>
    </div>
  </aside>

  <main class="workspace">
    
    <div *ngIf="openNotes.length === 0" class="hub-container">
      <div class="hub-watermark">ğŸ“</div>
      <div class="hub-content">
        <header class="hub-header">
          <h1>OlÃ¡, {{ userName }}! ğŸ‘‹</h1>
          <p class="hub-date">{{ today | date:"EEEE, d 'de' MMMM" }}</p>
          <div class="hub-stats-row">
            <span>VocÃª tem <b>{{ totalNotes }}</b> notas criadas</span>
            <span class="dot">â€¢</span>
            <span><b>{{ favCount }}</b> favoritas</span>
          </div>
        </header>
        <div class="hub-main-action">
          <button class="btn-big-create" (click)="createNote()">
            <span class="plus-icon">+</span>
            <span>Criar Nova Nota</span>
          </button>
        </div>
        <div class="scratchpad-wrapper">
          <div class="scratchpad-header">
            <span>ğŸš€ Rascunho RÃ¡pido (NÃ£o salvo no banco)</span>
          </div>
          <textarea 
            [(ngModel)]="scratchpadContent" 
            (input)="onScratchpadChange()"
            placeholder="Anote aqui algo rÃ¡pido..."
            class="scratch-input"
          ></textarea>
        </div>
      </div>
    </div>

    <div class="notes-grid" *ngIf="openNotes.length > 0">
      <div class="postit-card" *ngFor="let note of openNotes; let i = index" [style.backgroundColor]="note.cor">
        <div class="postit-header">
          <input type="text" [(ngModel)]="note.titulo" placeholder="TÃ­tulo" class="postit-title-input">
          <div class="postit-actions">
            <button class="btn-icon" (click)="note.favorita = !note.favorita" [class.fav]="note.favorita">â˜…</button>
            <button class="btn-icon close" (click)="closeNote(i)">âœ•</button>
          </div>
        </div>
        <div class="editor-toolbar" (mousedown)="$event.preventDefault()">
          <button (click)="formatText('bold')"><b>B</b></button>
          <button (click)="formatText('italic')"><i>I</i></button>
          <button (click)="formatText('underline')"><u>U</u></button>
          <div class="color-wrapper"><span style="color:red; font-weight:bold;">A</span><input type="color" (input)="formatText('foreColor', $any($event.target).value)"></div>
          <div class="color-wrapper"><span style="background:yellow;">M</span><input type="color" (input)="formatText('hiliteColor', $any($event.target).value)"></div>
        </div>
        <div class="postit-content-editable" contenteditable="true" [innerHTML]="note.conteudo" (blur)="updateContent($event, note)"></div>
        
        <div class="postit-footer-column">
          <div class="reminder-section">
            <span class="reminder-icon">â° Lembrete:</span>
            <input type="datetime-local" [(ngModel)]="note.dataLembrete" class="reminder-input">
          </div>

          <div class="colors-row">
             <div *ngFor="let color of availableColors" class="color-dot" [style.backgroundColor]="color" (click)="changeNoteColor(note, color)" [class.selected]="note.cor === color"></div>
          </div>
          <div class="footer-bottom-row">
            <span class="date" *ngIf="note.dataCriacao">{{ note.dataCriacao | date:'dd/MM/yyyy' }}</span>
            <div class="footer-btns">
              <button class="btn-icon-trash" (click)="deleteNote(note, i)">ğŸ—‘ï¸</button>
              <button class="btn-mini save" (click)="saveNote(note)">Salvar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
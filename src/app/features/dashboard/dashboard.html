<div class="dashboard-container">
  
  <aside class="sidebar">
    <div class="sidebar-header-wrapper">
        <div class="sidebar-header">
          <h2>Minhas Notas</h2>
          <button class="btn-new" (click)="createNote()" title="Criar nova nota">
            <span>+</span>
          </button>
        </div>
        <div class="search-box">
          <input type="text" placeholder="Buscar..." class="search-input" (input)="onSearch($event)">
        </div>
    </div>

    <div class="sidebar-list-scroll">
      
      <div class="note-group" *ngFor="let group of noteGroups">
        <div class="group-header" (click)="toggleGroup(group)" [style.border-left-color]="group.color">
           <div class="group-title">
             <span class="color-dot-indicator" [style.background]="group.color"></span>
             <span>{{ group.count }} notas</span>
           </div>
           <span class="arrow-icon">{{ group.isOpen ? '‚ñº' : '‚ñ∂' }}</span>
        </div>

        <div class="deck-container" *ngIf="group.isOpen" (wheel)="onDeckWheel($event, group)">
           
           <div 
             class="deck-card" 
             appTiltCard
             *ngFor="let note of group.notes; let i = index" 
             (click)="openNote(note)"
             
             [class.active]="i === group.activeIndex"
             
             [class.prev]="group.count > 1 && i === (group.activeIndex - 1 + group.count) % group.count"
             
             [class.next]="group.count > 1 && i === (group.activeIndex + 1) % group.count"
             
             [style.background]="getCardBackground(note.cor || '#fff')"
             [style.border-left-color]="note.cor || '#ccc'"
             [class.urgent-card]="isUrgent(note)"
           >
              <div class="card-content">
                  <div class="card-top-row">
                      <div class="note-title">{{ note.titulo || 'Sem T√≠tulo' }}</div>
                      <div *ngIf="note.dataLembrete" class="reminder-badge" [class.expired]="isExpired(note)">
                           {{ isExpired(note) ? '‚ö†Ô∏è' : '‚è∞' }}
                      </div>
                  </div>
                  <div class="note-preview">{{ getPreview(note) }}</div>
                  
                  <div class="card-bottom">
                      <span class="note-date">{{ note.dataCriacao | date:'dd/MM' }}</span>
                      <div class="scroll-hint" *ngIf="group.count > 1 && i === group.activeIndex">
                          <span style="font-size: 1.2rem;">‚Üï</span>
                      </div>
                  </div>
              </div>

              <div class="card-actions">
                 <button class="btn-mini-action btn-trash" (click)="deleteFromSidebar($event, note)" title="Excluir">üóë</button>
              </div>
           </div>
           
           <div *ngIf="group.notes.length === 0" class="empty-group" style="padding: 1rem; color: #999;">Vazio</div>
        </div>
      </div>
      
      <div style="height: 50px;"></div>
    </div>
  </aside>

  <main class="main-content">
    <div *ngIf="openNotes.length === 0" class="welcome-screen">
      <h1>Ol√°, {{ userName }}! üëã</h1>
      <p>Voc√™ tem <b>{{ totalNotes }}</b> notas criadas.</p>
      <button class="btn-big-create" (click)="createNote()">+ Criar Nova Nota</button>
      <div class="scratchpad-wrapper">
        <div class="scratchpad-header">üìå Rascunho R√°pido</div>
        <textarea [(ngModel)]="scratchpadContent" (input)="onScratchpadChange()" class="scratch-input" placeholder="Anote algo r√°pido..."></textarea>
      </div>
    </div>

    <div class="notes-grid">
        <div *ngFor="let openNote of openNotes; let i = index" class="sticky-note-container">
            <div class="postit-card" [style.border-top]="'6px solid ' + (openNote.cor || '#ccc')">
                <div class="postit-header">
                    <input [(ngModel)]="openNote.titulo" placeholder="T√≠tulo..." class="postit-title-input">
                    <div class="header-icons-row">
                        <button class="btn-icon clock" (click)="toggleDateEdit(openNote)" [class.active]="openNote.dataLembrete">‚è∞</button>
                        <button class="btn-icon close" (click)="closeNote(i)">‚úñ</button>
                    </div>
                </div>
                <div class="postit-meta" *ngIf="openNote.isDateEditing">
                    <label class="date-label">Data:<input type="datetime-local" [ngModel]="openNote.dataLembrete" (ngModelChange)="updateReminderDate(openNote, $event)" class="date-input"></label>
                </div>
                <textarea [(ngModel)]="openNote.conteudo" class="postit-content-editable" placeholder="Escreva sua nota..."></textarea>
                <div class="postit-footer">
                    <div class="colors-row">
                        <div *ngFor="let color of availableColors" class="color-circle" [style.background]="color" [class.selected]="openNote.cor === color" (click)="changeNoteColor(openNote, color)"></div>
                    </div>
                    <div class="footer-btns">
                        <button class="btn-mini save" (click)="saveNote(openNote)">üíæ</button>
                        <button class="btn-icon-trash" (click)="deleteNote(openNote, i)">üóë</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </main>
</div>

<div class="modal-overlay" *ngIf="showUrgentModal && criticalNotes.length > 0">
  <div class="modal-content atencao-maxima">
    <div class="modal-header-alert">
      <div class="modal-icon pulsing">üö®</div>
      <h2>Aten√ß√£o! {{ criticalNotes.length }} Tarefa(s)</h2>
    </div>
    <div class="urgent-list">
      <div *ngFor="let note of criticalNotes" class="urgent-item">
        <div class="urgent-info">
          <strong>{{ note.titulo || 'Sem T√≠tulo' }}</strong>
          <span class="urgent-time">{{ note.dataLembrete | date:'HH:mm' }}</span>
        </div>
        <button class="btn-check-mini" (click)="markAsDone(note)">‚úÖ</button>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-modal btn-success" (click)="markAsDone()">Concluir Todas</button>
      <button class="btn-modal btn-warning" (click)="snoozeTask()">Reagendar</button>
    </div>
    <button class="btn-link-close" (click)="snoozeTask()">Fechar</button>
  </div>
</div>